<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Neon Supabase Gallery</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body {
  margin: 0;
  padding: 20px;
  background: radial-gradient(circle at top, #1a1a2e, #050508);
  color: white;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
}
header {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  margin-bottom: 16px;
}
button {
  background: linear-gradient(135deg, #ff4fd8, #7df9ff);
  border: none;
  padding: 10px 14px;
  border-radius: 14px;
  font-weight: 600;
  cursor: pointer;
}
.grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
}
@media (min-width: 1080px) {
  .grid { grid-template-columns: repeat(6, 1fr); }
}
.slot {
  aspect-ratio: 1/1;
  border-radius: 18px;
  background: rgba(255,255,255,0.08);
  overflow: hidden;
  transition: transform 0.2s;
}
.slot:hover {
  transform: scale(1.05) rotateZ(1deg);
}
.slot img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.empty {
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 42px;
  opacity: 0.4;
  cursor: pointer;
}
</style>
</head>

<body>

<header>
  <button id="add">ADD</button>
  <button id="share">COPY LINK</button>
  <button id="reset">RESET</button>
</header>

<div class="grid" id="grid"></div>
<input type="file" id="file" accept="image/*" multiple>

<script>
/* ===== SETUP SUPABASE ===== */
const SUPABASE_URL = "https://mkrkiawrvnbugzyocxqe.supabase.co"; // schimbă aici
const SUPABASE_KEY = "sb_publishable_Fep-b-ylEk5mSI1kiaR6bQ_f2qBVR_t";             // schimbă aici

const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

const grid = document.getElementById("grid");
const fileInput = document.getElementById("file");

let galleryId = new URLSearchParams(location.search).get("id");
let images = [];

/* ===== LOAD EXISTING GALLERY ===== */
async function loadGallery() {
  if (!galleryId) return;
  const { data } = await supabase
    .from("galleries")
    .select("images")
    .eq("id", galleryId)
    .single();

  if (data) {
    images = data.images;
    render();
  }
}

/* ===== RENDER GRID ===== */
function render() {
  grid.innerHTML = "";
  images.forEach(src => {
    const slot = document.createElement("div");
    slot.className = "slot";
    const img = document.createElement("img");
    img.src = src;
    slot.appendChild(img);
    grid.appendChild(slot);
  });

  const empty = document.createElement("div");
  empty.className = "slot empty";
  empty.textContent = "+";
  empty.onclick = () => fileInput.click();
  grid.appendChild(empty);
}

/* ===== HANDLE FILE UPLOAD ===== */
fileInput.onchange = async () => {
  for (const file of fileInput.files) {
    const path = `${crypto.randomUUID()}-${file.name}`;

    await supabase.storage
      .from("images")
      .upload(path, file);

    const { data } = supabase.storage
      .from("images")
      .getPublicUrl(path);

    images.push(data.publicUrl);
  }

  if (!galleryId) {
    const { data } = await supabase
      .from("galleries")
      .insert({ images })
      .select()
      .single();

    galleryId = data.id;
    history.replaceState({}, "", "?id=" + galleryId);
  } else {
    await supabase
      .from("galleries")
      .update({ images })
      .eq("id", galleryId);
  }

  render();
};

/* ===== COPY LINK ===== */
document.getElementById("share").onclick = () => {
  navigator.clipboard.writeText(location.href);
  alert("Link copiat!");
};

/* ===== ADD BUTTON ===== */
document.getElementById("add").onclick = () => fileInput.click();

/* ===== RESET BUTTON ===== */
document.getElementById("reset").onclick = async () => {
  if (!galleryId) return;
  await supabase.from("galleries").delete().eq("id", galleryId);
  images = [];
  galleryId = null;
  history.replaceState({}, "", location.pathname);
  render();
};

/* ===== INIT ===== */
loadGallery();
</script>

</body>
</html>